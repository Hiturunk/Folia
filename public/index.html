<!doctype html>
  <head>
    <script>
    var key = 'demo';
    var portfolio = [];
    var tools = ["addFinancialAccountPlanner().account_balance","removeAccount().work_off","inputStockAPIKEY().youtube_searched_for","renderAccountTable().history","resetPortfolio().power_settings_new"]
    var plannerOpen=0;
      function setBalance(arrayLoc){
        var a = prompt("Set Balance","0");
        portfolio[arrayLoc].setBalance(a);
        renderAccountTable();
      }
      function cardConstructor(id,titleData,data,arrayLoc){
        //Three strings expected
        var card = document.createElement("div");
        card.id=id;
        var title = document.createElement("h1");
        title.innerHTML=titleData;
        var p1 = document.createElement("p");
        var text = document.createTextNode(data);
        p1.appendChild(text);
        var balanceButton = document.createElement("i");
        balanceButton.innerHTML="add";
        balanceButton.setAttribute("onclick","setBalance("+arrayLoc+")");
        card.appendChild(title);
        card.appendChild(p1);
        card.appendChild(balanceButton);
        card.setAttribute("class","card");
        return card;
      }
      function balanceChecker(){
        var bal = 0;
        for(i=0;i<portfolio.length;i++){
          bal+=Number(portfolio[i].balance);
        }
        return bal;
      }
      function incomeChecker(){
        var inc = 0;
        for(i=0;i<portfolio.length;i++){
          inc+=portfolio[i].projectedMonthlyIncome();
        }
        return inc;
      }
      function inputStockAPIKEY(){
        var stockAPIKEY = prompt("Please Enter your API key for stock data..","demo");
        key == stockAPIKEY;
      }
      function simpleInterest(x,apy){
        return x*apy;
      }
      function Portfolio(accounts){
        this.accounts = accounts;
      }
      function Bank(name,balance,apy){
      this.type="Bank";
      this.name = name;
      this.balance = balance;
      this.apy = apy;
      this.projectedMonthlyIncome = function(){
        return this.balance*this.apy/12;
      }
      this.setBalance = function(amt){
        this.balance=amt;
      }
    }
      function Broker(name,balance,apy){
        this.type="Broker";
        this.name = name;
        this.balance = balance;
        this.apy = apy;
        this.assets = [];
        //We will probably allow to pass an array of assets to the brokerageAccount constructor in the future..though this solution for now makes more sense..
        this.projectedMonthlyIncome = function(){
          var a = 0;
          if(this.assets.length>0){
            for(i=0;i<=this.assets.length;i++){
              if(this.assets[i]){
              a += this.assets[i].projectedMonthlyIncome();
            }
            }
          }
          a+=this.projectedMonthlyInterest();
          return a;
        }
        this.projectedMonthlyInterest=function(){
          return this.apy*this.balance/12;
        }
        this.addAsset = function(assetObj){
          this.assets.push(assetObj);
          console.log("asset added to"+this.name);
        }
        this.removeAsset = function(id){
          for(i=0;i<=this.assets.length;i++){
            if(this.assets[i].name===id){
              this.assets.splice(i,1);
            }
          }
        }
      }
      function asset(name,price,dividend,dividendsPerYear){
        this.name = name;
        this.price = price;
        this.dividend = dividend;
        this.dividendsPerYear = dividendsPerYear;
        this.quantity=0;
        this.livePrice = function(){
          //future live price function
          //No longer the future!
          this.price = getQuote(this.name,key);
        }
        this.setQuantity = function(q){
          this.quantity=q;
        }
        this.projectedMonthlyIncome = function(){
          var yearly = this.dividend*this.dividendsPerYear*this.quantity;
          var monthly = yearly/12;
          return monthly;
        }
      }
      function salary(amt){
        this.monthly = amt/12;
        this.yearly = amt;
      }
      function returnQuote(x){
        return x
      }
      function getQuote(ticker,key){
        //Using an API to import a quote..
        var requestURL = 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol='+ticker+'&apikey='+key+'';
        var request = new XMLHttpRequest();
          request.open('GET', requestURL,true);
          request.onload=function(){
            var data = this.response;
            if(this.readyState==4&&this.status==200){
                console.log(data["Global Quote"]["01. symbol"])
                console.log(data["Global Quote"]["05. price"]);
                console.log(data);
                var result = JSON.stringify(data["Global Quote"]["05. price"]);
              }
      }
      request.send();
      }
      function resetPortfolio(){
                var dare = prompt("ARE YOU SURE!? Y=1,N=0","0");
                if(dare==1){portfolio=[];renderAccountTable()}
      }
      function parseQuote(ticker,key){
      }
      function renderToolBar(){
        var toolbar = document.createElement("tr");
        toolbar.id="toolbar";
        for(i=0;i<tools.length;i++){
          var spl = tools[i].split('.');
          var a = document.createElement("i");
          a.setAttribute("onclick",spl[0]);
          a.setAttribute("class","material-icons md-60");
          a.innerHTML=spl[1];
          toolbar.appendChild(a);
        }
        document.body.appendChild(toolbar);
      }
      function renderBankAccountCard(acct,arrayLoc){
        var id = acct.name;
        var title = acct.name;
        var data = "Balance: "+acct.balance+", APY: "+acct.apy+", Income Per Month:"+acct.projectedMonthlyIncome()+"";
        var cardObj = cardConstructor(id,title,data,arrayLoc);
        return cardObj;
      }
      function renderAccountTable(){
        var target = document.getElementById("accountTable");
        if(target){target.parentElement.removeChild(target);}
        var folia = portfolio;
        var tableEl = document.createElement("div");
        tableEl.id="accountTable";
        var income = document.createElement("tr");
        var incomeText=document.createTextNode("Income Per Month:");
        var incomeVal = document.createTextNode(incomeChecker());
        income.appendChild(incomeText);
        income.appendChild(incomeVal);
        var balance = document.createElement("tr");
        var balanceText = document.createTextNode("Net Worth:")
        var balanceVal = document.createTextNode(balanceChecker());
        balance.appendChild(balanceText);
        balance.appendChild(balanceVal);
        var acctSelector = document.createElement("select");
        tableEl.appendChild(income);
        tableEl.appendChild(balance);
        for(i=0;i<portfolio.length;i++){
          var accountEl = document.createElement("div");
          if(portfolio[i]){
            if(portfolio[i].type==="Bank"){
              accountEl.appendChild(renderBankAccountCard(portfolio[i],i));
            }
            else{
          accountEl.innerHTML=JSON.stringify(portfolio[i]);
        }
          tableEl.appendChild(accountEl);
          }
        }
        for(i=0;i<portfolio.length;i++){
          var option = document.createElement("option");
          option.value=i;
          option.innerHTML=portfolio[i].name;
          acctSelector.appendChild(option);
        }
        tableEl.appendChild(acctSelector);
        document.body.appendChild(tableEl);
      }
      function bankFactory(){
        var a = document.getElementById("finAcctPlanner_Name").value;
        var b = document.getElementById("finAcctPlanner_Balance").value;
        var c = document.getElementById("finAcctPlanner_Apy").value;
        var obj = new Bank(a,b,c);
        portfolio.push(obj);
        renderAccountTable();
      }
      function brokerFactory(){
        var a = document.getElementById("finAcctPlanner_Name").value;
        var b = document.getElementById("finAcctPlanner_Balance").value;
        var c = document.getElementById("finAcctPlanner_Apy").value;
        var obj = new Broker(a,b,c);
        portfolio.push(obj);
        renderAccountTable();
      }
      function addFinAccount(){
        var a = document.getElementById("acctTypeSelect");
        if(a.value==="Bank"){
          bankFactory();
        }
        if(a.value==="Broker"){
          brokerFactory();
        }
      }
      function addFinancialAccountPlanner(){
        if(plannerOpen==1){
          plannerOpen=0;
          var a = document.getElementById("finAcctPlanner");
          a.parentElement.removeChild(a);
        }
        else{
        plannerOpen=1;
        var obj = document.createElement("div");
        obj.id="finAcctPlanner";
        obj.appendChild(document.createTextNode("Enter the Name, Institution, Balance, and APY of your new account.."));
        var nameObj=document.createElement("td");
        var nameText=document.createTextNode("Bank/Broker:");
        var name = document.createElement("textarea");
        name.id="finAcctPlanner_Name";
        nameObj.appendChild(nameText);
        nameObj.appendChild(name);
        var instObj = document.createElement("td");
        var balObj = document.createElement("td");
        var balanceText=document.createTextNode("Balance");
        var balance = document.createElement("textarea");
        balance.id="finAcctPlanner_Balance";
        balObj.appendChild(balanceText);
        balObj.appendChild(balance);
        var apyObj=document.createElement("td");
        var apyText=document.createTextNode("APY:");
        var apy = document.createElement("textarea");
        apy.id="finAcctPlanner_Apy"
        apyObj.appendChild(apyText);
        apyObj.appendChild(apy);
        var acctType = document.createElement("select");
        acctType.id="acctTypeSelect";
        var opt1 = document.createElement("option");
        opt1.value="Bank";
        opt1.innerHTML="Bank";
        var opt2 = document.createElement("option");
        opt2.value="Broker";
        opt2.innerHTML="Broker";
        acctType.appendChild(opt1);
        acctType.appendChild(opt2);
        var button = document.createElement("i");
        button.setAttribute('onclick','addFinAccount()');
        button.setAttribute('class',"material-icons md-60");
        button.innerHTML="star_rate";
        obj.appendChild(nameObj);
        obj.appendChild(instObj);
        obj.appendChild(balObj);
        obj.appendChild(apyObj);
        obj.appendChild(acctType);
        obj.appendChild(button);
        document.body.appendChild(obj);
        }
      }
      function start(){
        renderToolBar();
        addFinancialAccountPlanner();
        renderAccountTable();
      }
    </script>
    <style>
      .card{
        border-style:ridge;
        border-color:gold;
        border-width: thin;
        background-color:grey;
        text-align:center;
      }
      i{
        height:1em;
        width:1em;
      }
      #toolbar{
        border-width:medium;
        border-style:inset;
        border-color:black;
        background-color:#9999FF;
        margin:auto;
        text-align: center;
        display:block;
      }
      .material-icons.md-60 { font-size: 60px; }
      #finAcctPlanner{
        background-color:gold;
        border-width:thin;
        border-color:black;
        border-style: ridge;
        display:block;
      }
      #accountTable{
        background-color:white;
        border-style:gold;
        border-width:thin;
        display:block;
      }
      #accountTable td{
        border-width:thin;
        margin: 0.5em;
      }
      #titleBar{
        background-color:white;
        border-color:gold;
        align-self:center;
        text-align: center;
        display:block;
        color:#9999FF;
        margin:auto;
      }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <link href="../stylesheets/stars.css"rel="stylesheet">
  </head>
  <body onload="start()">
    <h1 id="titleBar">FOLIA</h1>
    <div id="stars">
    <div id="stars2">
    <div id="stars3">
  </body>
</html>
